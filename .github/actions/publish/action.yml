name: "Publish Docker Image"
description: "Publish Docker Image to Artifact Registry"

inputs:
  image_tags:
    description: "Docker image tags"
    required: true

runs:
  using: "composite"
  steps:
    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v2
      id: auth
      with:
        project_id: ${{ secrets.PROJECT_ID }}
        service_account: ${{ secrets.SERVICE_ACCOUNT }}
        workload_identity_provider: ${{ secrets.WORKLOAD_IDENTITY_PROVIDER }}

    - name: Docker Auth
      uses: docker/login-action@v3
      with:
        username: oauth2accesstoken
        password: ${{ steps.auth.outputs.auth_token }}
        registry: ${{ secrets.REGION }}-docker.pkg.dev

    - name: Configure docker to use the gcloud cli
      shell: bash
      run: gcloud auth configure-docker ${{ secrets.REGION }}-docker.pkg.dev --quiet

    - name: Build and Push Container
      uses: docker/build-push-action@v6
      with:
        push: true
        tags: ${{ inputs.image_tags }}
